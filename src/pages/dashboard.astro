---
// --- 1. IMPORTS ---
import plmLogo from "../assets/PLMLogo.webp";
import "../styles/global.css";
import { Image } from "astro:assets";

// --- 2. TYPE DEFINITIONS (The Contract) ---
// This defines what data the UI expects, whether from a fake file or real DB.
interface StudentProfile {
    firstName: string;
    lastName: string;
    studentId: string;
    email: string;
    college: string;
    course: string;
    yearLevel: string;
    status: "Regular" | "Irregular" | "Conditional";
    isEnrolled: boolean;
    currentSemester: string;
    gwa: number;
    progress: number;
    // New fields required for the Desktop UI stats
    units: {
        totalEarned: number;
        academic: number;
        nonAcademic: number;
    };
}

// --- 3. SIMULATED BACKEND FUNCTION ---
// Currently returns temp info. Later, you can put a 'fetch()' here.
async function fetchStudentProfile(): Promise<StudentProfile> {
    
    // Simulate network delay (optional)
    // await new Promise(resolve => setTimeout(resolve, 50));

    return {
        firstName: "EMMANUEL A.",
        lastName: "PEREZ",
        studentId: "202390029",
        email: "eaperez2023@plm.edu.ph",
        college: "College of Information System and Technology Management - Undergraduate",
        course: "Bachelor of Science in Computer Science",
        yearLevel: "Second Year",
        status: "Irregular",
        isEnrolled: true,
        currentSemester: "School Year 2025-2026 First Semester",
        gwa: 1.45608,
        progress: 43,
        units: {
            totalEarned: 95,
            academic: 89,
            nonAcademic: 6
        }
    };
}

// --- 4. EXECUTE DATA FETCH ---
const studentData = await fetchStudentProfile();

// Helper to format money (kept from your original code, in case needed later)
const formatCurrency = (val: number) => new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' }).format(val);
---

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLM Student Portal</title>
    <link rel="icon" href={plmLogo.src} />
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-50 font-sans min-h-screen flex flex-col">

    <header class="w-full bg-white shadow-sm z-50">

        <div class="flex justify-center py-4">
            <div class="w-15 h-15">
                 <Image src={plmLogo} alt="PLM Logo" class="w-full h-full object-contain" loading="eager" />
            </div>
        </div>
    <div class="h-5 w-full bg-plm-navy border-b-9 border-[#991B1B]"></div>
        <nav class="border-y border-gray-200 py-2">
            <div class="max-w-7xl mx-auto px-4 flex justify-around md:justify-center md:gap-12 text-sm font-medium text-gray-700">
                <a href="#" class="bg-plm-navy text-white px-6 py-2 rounded shadow-sm hover:bg-opacity-90 transition-all">
                    Home
                </a>

                <a href="/student_schedule" class="px-6 py-2 rounded hover:text-plm-navy hover:bg-plm-navy/20 transition-all">
                    Schedule
                </a>

                <a href="/grade" class="px-6 py-2 rounded hover:text-plm-navy hover:bg-plm-navy/20 transition-all">
                    Grade
                </a>

                <a href="/enrollment" class="px-6 py-2 rounded hover:text-plm-navy hover:bg-plm-navy/20 transition-all">
                    Enrollment
                </a>

                <a href="/personalinfo" class="px-6 py-2 rounded hover:text-plm-navy hover:bg-plm-navy/20 transition-all">
                    Personal Info
                </a>

                <a href="/change-password" class="px-6 py-2 rounded hover:text-plm-navy hover:bg-plm-navy/20 transition-all">
                    Change Password
                </a>

            </div>
        </nav>

        <div class="bg-white border-b border-plm-gold/50 py-2">
            <div class="max-w-7xl mx-auto px-4 flex justify-between items-center text-sm">
                <span class="text-gray-800">
                    Signed in as: <span class="font-bold uppercase">{studentData.lastName}, {studentData.firstName}</span> <span class=" font-bold">({studentData.studentId})</span>
                </span>
                <button class="text-[#991B1B] font-bold hover:underline text-xs tracking-wide">SIGN OUT</button>
            </div>
        </div>
    </header>

    <main class="flex-grow w-full max-w-7xl mx-auto p-6 md:p-10">
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-8 relative">
                <h2 class="text-2xl font-bold uppercase text-gray-900 mb-6">Student Information</h2>
                
                <div class="flex flex-col-reverse md:flex-row gap-6">
                    <div class="flex-1 space-y-3 text-sm text-gray-700">
                        <div class="grid grid-cols-[140px_1fr]">
                            <span class="font-semibold text-gray-600">Student ID No.</span>
                            <span class="font-bold text-black">: {studentData.studentId}</span>
                        </div>
                        <div class="grid grid-cols-[140px_1fr]">
                            <span class="font-semibold text-gray-600">Student Name</span>
                            <span class="font-bold text-black uppercase">: {studentData.lastName}, {studentData.firstName}</span>
                        </div>
                        <div class="grid grid-cols-[140px_1fr]">
                            <span class="font-semibold text-gray-600">Program/Degree</span>
                            <span>: {studentData.course}</span>
                        </div>
                        <div class="grid grid-cols-[140px_1fr]">
                            <span class="font-semibold text-gray-600">College</span>
                            <span>: {studentData.college}</span>
                        </div>
                        <div class="grid grid-cols-[140px_1fr]">
                            <span class="font-semibold text-gray-600">PLM Email</span>
                            <span>: {studentData.email}</span>
                        </div>
                        <div class="grid grid-cols-[140px_1fr]">
                            <span class="font-semibold text-gray-600">Year Level</span>
                            <span>: {studentData.yearLevel}</span>
                        </div>
                        <div class="grid grid-cols-[140px_1fr]">
                            <span class="font-semibold text-gray-600">Registration Status</span>
                            <span>: {studentData.status}</span>
                        </div>
                        <div class="grid grid-cols-[140px_1fr] items-start pt-2">
                            <span class="font-semibold text-gray-600">Enrollment Status</span>
                            <div>
                                : <span class={`font-bold uppercase ${studentData.isEnrolled ? 'text-red-600' : 'text-gray-500'}`}>
                                    {studentData.isEnrolled ? 'ENROLLED' : 'NOT ENROLLED'}
                                  </span> 
                                <span class="text-gray-500 text-xs block mt-0.5">for {studentData.currentSemester}</span>
                            </div>
                        </div>
                    </div>

                    <div class="w-32 h-32 md:w-40 md:h-40 flex-shrink-0 bg-gray-200 rounded-md overflow-hidden border border-gray-300 self-start">
                        <img src={`https://api.dicebear.com/7.x/avataaars/svg?seed=${studentData.firstName}`} alt="Profile" class="w-full h-full object-cover opacity-80" />
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Overall Student Progress</h2>

                <div class="flex flex-col md:flex-row items-center gap-8">
                    
                    <div class="relative w-40 h-40 flex-shrink-0">
                        <div class="w-full h-full rounded-full" 
                             style={`background: conic-gradient(#002d72 ${studentData.progress}%, #e5e7eb 0);`}>
                        </div>
                        <div class="absolute inset-4 bg-white rounded-full flex items-center justify-center flex-col">
                            <span class="text-3xl font-bold text-plm-navy">{studentData.progress}%</span>
                        </div>
                    </div>

                    <div class="flex-1 space-y-4 text-sm">
                        <p class="text-gray-600">
                            You've completed <span class="font-bold text-black">{studentData.progress}%</span> of your classes' overall assigned curriculum.
                        </p>
                        
                        <p class="text-gray-600">
                            Your can view the details in <span class="font-bold text-black">My Grades Curriculum/Prospectus.</span>
                        </p>

                        <div class="space-y-1 pt-2">
                            <div class="flex justify-between border-b border-gray-100 pb-1">
                                <span class="font-semibold text-gray-600">Overall GWA :</span>
                                <span class="font-bold">{studentData.gwa.toFixed(5)}</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-100 pb-1">
                                <span class="font-semibold text-gray-600">Actual Total Units Earned :</span>
                                <span class="font-bold">{studentData.units.totalEarned}</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-100 pb-1">
                                <span class="font-semibold text-gray-600">Academic Units :</span>
                                <span class="font-bold">{studentData.units.academic}</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-100 pb-1">
                                <span class="font-semibold text-gray-600">Non-Academic Units :</span>
                                <span class="font-bold">{studentData.units.nonAcademic}</span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>

    </main>
    
    <script src="../scripts/navigation.ts"></script>
</body>
</html>